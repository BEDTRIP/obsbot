# obsbot

Программа для сохранения сообщений из IMAP-почты и Telegram-групп в Markdown-файлы с вложениями. Работает в Docker.

## Возможности
- Поддержка IMAP: чтение новых писем, фильтрация по белому списку отправителей, сохранение содержимого и вложений
- Поддержка Telegram-бота: работа в группах, фильтрация отправителей, сохранение сообщений и медиа, реакция на сохранённые сообщения
- Уведомление в Telegram при сохранении письма с почты
- Сохранение в общую папку на хосте: `/folder` (маппится через volume)
- HTTP `/health` для проверки статуса

## Запуск
1. Заполните переменные окружения в `docker-compose.yaml` (см. раздел Конфигурация)
2. Подготовьте директорию для данных на хосте: `mkdir -p data/folder`
3. Соберите и запустите:
   ```bash
   docker compose up -d --build
   ```

После старта:
- HTTP-эндпоинт доступен на `http://localhost:8080/health`
- Все сохранённые материалы появятся в `./data/folder` на вашей машине

## Конфигурация (переменные окружения)
- `HTTP_PORT` — порт HTTP-сервера внутри контейнера (по умолчанию 8080)
- `STORAGE_DIR` — директория для сохранения сообщений (в контейнере), по умолчанию `/folder`
- `ATTACHMENTS_SUBDIR` — подпапка для вложений (по умолчанию `attachments`)
- `WHITELIST_EMAILS` — список email-адресов, через запятую
- `WHITELIST_TG_USERNAMES` — Telegram username без `@`, через запятую
- `WHITELIST_TG_IDS` — Telegram user ID, через запятую (числа)
- `TELEGRAM_BOT_TOKEN` — токен бота (получите у @BotFather)
- `TELEGRAM_NOTIFY_CHAT_ID` — чат, куда отправлять уведомления при сохранении почтового письма
- `IMAP_HOST`, `IMAP_PORT`, `IMAP_USER`, `IMAP_PASSWORD`, `IMAP_SSL` — настройки IMAP
- `IMAP_POLL_INTERVAL` — интервал опроса IMAP в секундах (по умолчанию 60)

## Важно для Telegram-групп
- Добавьте бота в группу
- Отключите у бота «privacy mode» в @BotFather, чтобы он видел все сообщения

## Формат сохранения
- Каждое сообщение сохраняется как Markdown-файл в `STORAGE_DIR`
- Вложения сохраняются в `STORAGE_DIR/ATTACHMENTS_SUBDIR`
- Внутри Markdown на вложения ставятся ссылки вида: `![[file.ext]]`

## Примечания
- Для HTML-писем выполняется конвертация в Markdown
- Если API реакций недоступен для вашего бота, бот ответит смайликом в потоке


